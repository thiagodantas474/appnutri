<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Jogo ABC da Nutri√ß√£o ‚Äî An√°lise Funcional (Mobile)</title>
  <style>
    :root{
      --bg:#0b1020; --text:#e9eeff;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 20% 10%, #1a2a6a22, transparent),
        radial-gradient(1200px 700px at 80% 30%, #7c3aed22, transparent),
        var(--bg);
      color:var(--text);
      font-family:var(--sans);
      min-height:100vh;
      padding: max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right))
               max(14px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
      display:flex;
      align-items:stretch;
      justify-content:center;
    }
    .wrap{width:min(1050px, 100%); display:grid; gap:12px; align-content:start}
    header{
      padding:14px 14px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, #121a37, #0f1633);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06);
      display:grid;
      gap:10px;
    }
    header h1{margin:0; font-size:16px; letter-spacing:.2px}
    header .sub{color:rgba(233,238,255,.75); font-size:12.5px; line-height:1.3}
    .stats{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .pill{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      padding:7px 9px;
      border-radius: 999px;
      font-size:12px;
      color: rgba(233,238,255,.85);
      display:flex; gap:6px; align-items:center;
    }
    .pill b{font-family:var(--mono); font-weight:700; color:var(--text)}
    .btn{
      border:none; cursor:pointer; border-radius: 12px;
      padding:10px 12px; font-weight:700; letter-spacing:.2px;
      background: linear-gradient(180deg, rgba(43,60,255,.95), rgba(43,60,255,.75));
      color:white;
      box-shadow: 0 8px 18px rgba(43,60,255,.25);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .btn.secondary{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:none;
    }
    main{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      align-content:start;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      background: rgba(0,0,0,.12);
    }
    .badge{
      font-family:var(--mono); font-size:12px;
      padding:6px 10px; border-radius:999px;
      background: rgba(43,60,255,.18);
      border: 1px solid rgba(43,60,255,.35);
      color: rgba(233,238,255,.92);
      white-space:nowrap;
    }
    .small{font-size:12px; color: rgba(233,238,255,.7)}
    .kpi{font-family:var(--mono); font-size:12px; color: rgba(233,238,255,.9)}
    .case{padding:14px; font-size:15px; line-height:1.35}
    .hint{margin-top:10px; color: rgba(233,238,255,.75); font-size:13px}

    /* Mobile tabs */
    .tabs{
      display:flex;
      gap:8px;
      padding:10px 10px 0 10px;
      background: rgba(0,0,0,.10);
      border-bottom: 1px solid rgba(255,255,255,.08);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(8px);
    }
    .tab{
      flex:1;
      border-radius: 999px;
      padding:10px 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(22,34,74,.55);
      color: rgba(233,238,255,.92);
      font-weight:800;
      font-size:12px;
      text-align:center;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .tab.active{
      background: rgba(43,60,255,.35);
      border-color: rgba(43,60,255,.55);
    }
    .panel{padding:12px 14px;}
    .block{
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding:12px;
      display:none;
    }
    .block.active{display:block}
    .block .lbl{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin-bottom:8px;
      font-size:12px; color: rgba(233,238,255,.78);
      text-transform: uppercase; letter-spacing: .12em;
    }
    .choices{display:grid; gap:10px}
    .choice{
      width:100%;
      border-radius: 14px;
      padding:12px 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(22,34,74,.55);
      color: var(--text);
      text-align:left;
      cursor:pointer;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      font-size:14px;
      line-height:1.25;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .choice:active{transform: scale(.99)}
    .choice[aria-pressed="true"]{background: rgba(43,60,255,.35); border-color: rgba(43,60,255,.55)}
    .choice.ok{background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.45)}
    .choice.bad{background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.45)}

    .row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top:12px;
    }
    .row .btn{flex:1; min-width: 140px}

    .feedback{
      margin-top:12px;
      border-radius: 14px;
      padding:12px;
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.08);
      display:none;
    }
    .feedback.show{display:block}
    .feedback h3{margin:0 0 6px 0; font-size:14px}
    .feedback p{margin:0; color: rgba(233,238,255,.85); font-size:13px; line-height:1.35}

    /* Sticky action bar (mobile) */
    .actionbar{
      position: sticky;
      bottom: 0;
      z-index: 20;
      padding:10px;
      background: rgba(8,12,28,.86);
      border-top: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      display:flex;
      gap:10px;
    }
    .actionbar .btn{flex:1}
    .actionbar .btn.secondary{flex:.9}

    /* Desktop: show side-by-side and all blocks */
    @media (min-width: 980px){
      main{grid-template-columns: 1.1fr .9fr}
      .tabs{display:none}
      .block{display:block}
      .block.active{display:block}
      .actionbar{display:none}
      header{
        display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      }
      .stats{justify-content:flex-end}
    }

    /* Modal */
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,.55);
      padding:18px;
    }
    .modal.show{display:flex}
    .modal .box{
      width:min(760px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal .box .hd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
    }
    .modal .box .bd{padding:16px}
    .table{width:100%; border-collapse: collapse; margin-top:10px; font-size:13px;}
    .table th,.table td{border-bottom:1px solid rgba(255,255,255,.10); padding:10px 8px; text-align:left;}
    .table th{color: rgba(233,238,255,.75); font-weight:750; font-size:12px; text-transform:uppercase; letter-spacing:.08em}
    .kbd{font-family:var(--mono); background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Jogo ABC da Nutri√ß√£o ‚Äî An√°lise Funcional</h1>
        <div class="sub">No celular, jogue por etapas: escolha <b>A</b> ‚Üí <b>B</b> ‚Üí <b>C</b>. Todas as alternativas s√£o plaus√≠veis (o erro √© por fun√ß√£o, n√£o por absurdo).</div>
      </div>
      <div class="stats">
        <div class="pill">Rodada <b id="round">1</b>/<b id="total">10</b></div>
        <div class="pill">Pontos <b id="score">0</b></div>
        <div class="pill">Acertos <b id="hits">0</b></div>
        <button class="btn secondary" id="helpBtn" type="button">Regras</button>
      </div>
    </header>

    <main>
      <!-- Case -->
      <section class="card" aria-live="polite">
        <div class="hd">
          <div>
            <div class="badge" id="tag">Caso</div>
            <div class="small" id="meta"></div>
          </div>
          <div class="kpi" id="timer">‚è±Ô∏è Tempo: ‚Äî</div>
        </div>

        <div class="case">
          <div id="caseText"></div>
          <div class="hint" id="caseHint"></div>

          <div class="feedback" id="feedback">
            <h3 id="fbTitle"></h3>
            <p id="fbText"></p>
            <p class="small" id="fbExtra"></p>
          </div>

          <div class="row" id="desktopRow">
            <button class="btn secondary" id="skipBtn" type="button">Pular</button>
            <div style="display:flex; gap:10px; width:min(420px,100%);">
              <button class="btn secondary" id="resetBtn" type="button" style="flex:1;">Reiniciar</button>
              <button class="btn" id="submitBtn" type="button" disabled style="flex:1;">Conferir</button>
              <button class="btn" id="nextBtn" type="button" style="display:none; flex:1;">Pr√≥ximo</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Selection panel -->
      <aside class="card">
        <div class="hd">
          <div>
            <div class="badge">Selecione as op√ß√µes</div>
            <div class="small">Dica: <b>B</b> √© a√ß√£o observ√°vel. <b>C</b> √© efeito imediato (prazer/al√≠vio/evita√ß√£o/aten√ß√£o).</div>
          </div>
          <div class="kpi">Atalhos: <span class="kbd">1</span> A ¬∑ <span class="kbd">2</span> B ¬∑ <span class="kbd">3</span> C</div>
        </div>

        <div class="tabs" role="tablist" aria-label="Etapas ABC">
          <button class="tab active" id="tabA" role="tab" aria-selected="true">A (Anteced.)</button>
          <button class="tab" id="tabB" role="tab" aria-selected="false">B (Comport.)</button>
          <button class="tab" id="tabC" role="tab" aria-selected="false">C (Consequ.)</button>
        </div>

        <div class="panel">
          <div class="block active" id="blockA">
            <div class="lbl"><span>Antecedente (A)</span><span class="small" id="selA">‚Äî</span></div>
            <div class="choices" id="choicesA"></div>
          </div>

          <div class="block" id="blockB">
            <div class="lbl"><span>Comportamento (B)</span><span class="small" id="selB">‚Äî</span></div>
            <div class="choices" id="choicesB"></div>
          </div>

          <div class="block" id="blockC">
            <div class="lbl"><span>Consequ√™ncia (C)</span><span class="small" id="selC">‚Äî</span></div>
            <div class="choices" id="choicesC"></div>
          </div>
        </div>

        <div class="actionbar" id="actionbar">
          <button class="btn secondary" id="prevStepBtn" type="button">‚óÄ Voltar</button>
          <button class="btn secondary" id="nextStepBtn" type="button">Avan√ßar ‚ñ∂</button>
          <button class="btn" id="submitBtnMobile" type="button" disabled>Conferir</button>
        </div>
      </aside>
    </main>
  </div>

  <!-- Help modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="box">
      <div class="hd">
        <div>
          <div class="badge" id="mTitle">Regras r√°pidas</div>
          <div class="small">ABC = Antecedente, Comportamento, Consequ√™ncia</div>
        </div>
        <button class="btn secondary" id="closeBtn" type="button">Fechar</button>
      </div>
      <div class="bd">
        <ul style="margin:0; padding-left:18px; color:rgba(233,238,255,.88); line-height:1.4;">
          <li><b>A</b>: contexto que aumenta a chance do comportamento (gatilho, ambiente, emo√ß√£o, rotina, est√≠mulo discriminativo).</li>
          <li><b>B</b>: comportamento <b>observ√°vel</b> (o que a pessoa faz).</li>
          <li><b>C</b>: efeito <b>imediato</b> que pode manter (prazer, al√≠vio, evita√ß√£o, aten√ß√£o, praticidade).</li>
          <li>Pontua√ß√£o: <b>+10</b> por item correto (A, B, C). Total <b>30</b> por caso.</li>
        </ul>
        <table class="table" aria-label="Exemplo r√°pido">
          <thead><tr><th>Exemplo</th><th>Resposta</th></tr></thead>
          <tbody>
            <tr><td>Chega cansada, v√™ doces na mesa.</td><td><b>A</b>: cansa√ßo + doce dispon√≠vel</td></tr>
            <tr><td>Come doces rapidamente.</td><td><b>B</b>: ingest√£o impulsiva</td></tr>
            <tr><td>Al√≠vio imediato; culpa depois.</td><td><b>C</b>: al√≠vio imediato mant√©m</td></tr>
          </tbody>
        </table>
        <p class="small" style="margin:10px 0 0 0;">No celular: selecione A ‚Üí avance ‚Üí selecione B ‚Üí avance ‚Üí selecione C ‚Üí conferir.</p>
      </div>
    </div>
  </div>

<script>
(() => {
  // ‚úÖ Banco refeito: TODAS as alternativas s√£o plaus√≠veis e pr√≥ximas da cena (erro = por fun√ß√£o).
  const BANK = [
    {
      tag: "Comer emocional",
      meta: "Adulto ‚Ä¢ consult√≥rio",
      text: "Ap√≥s uma reuni√£o estressante, a paciente chega em casa, abre o arm√°rio e come biscoitos doces rapidamente, mesmo sem fome.",
      hint: "Procure o gatilho imediato e o efeito de curto prazo (o que mant√©m o padr√£o).",
      A: "Vivenciar uma reuni√£o estressante e chegar em casa com tens√£o/ansiedade",
      B: "Come biscoitos doces rapidamente, mesmo sem fome fisiol√≥gica",
      C: "Sente al√≠vio emocional imediato e conforto moment√¢neo",
      optsA: [
        "Vivenciar uma reuni√£o estressante e chegar em casa com tens√£o/ansiedade",
        "Chegar em casa no fim do dia e ficar sozinho por alguns minutos",
        "Sentir cansa√ßo f√≠sico e querer relaxar depois do trabalho",
        "Ver biscoitos doces dispon√≠veis no arm√°rio/cozinha ao entrar"
      ],
      optsB: [
        "Come biscoitos doces rapidamente, mesmo sem fome fisiol√≥gica",
        "Belisca pequenas por√ß√µes enquanto anda pela cozinha",
        "Come fora do planejado e repete por√ß√µes √† noite",
        "Vai para a cozinha e procura algo doce para comer"
      ],
      optsC: [
        "Sente al√≠vio emocional imediato e conforto moment√¢neo",
        "Reduz momentaneamente pensamentos estressantes (distra√ß√£o)",
        "Sente prazer sensorial imediato (sabor) e relaxamento",
        "Diminui a tens√£o corporal no curto prazo"
      ],
      explain: "O comportamento pode se manter porque produz al√≠vio/conforto imediato (refor√ßo negativo/positivo), mesmo que depois venha culpa."
    },
    {
      tag: "Padaria no caminho",
      meta: "Adulto ‚Ä¢ rotina",
      text: "No caminho do trabalho, sempre que passa pela padaria, o paciente compra salgado e refrigerante, apesar de ter levado lanche de casa.",
      hint: "Pense em est√≠mulos do ambiente e em consequ√™ncias imediatas (prazer/praticidade).",
      A: "Passar em frente √† padaria (cheiro/vitrine) no trajeto habitual",
      B: "Compra salgado e refrigerante na padaria antes de chegar ao trabalho",
      C: "Sente prazer imediato e praticidade (evita esfor√ßo de usar o lanche levado)",
      optsA: [
        "Passar em frente √† padaria (cheiro/vitrine) no trajeto habitual",
        "Estar com fome moderada perto do hor√°rio do lanche",
        "Ver colegas entrando na padaria no mesmo hor√°rio",
        "Ter o dinheiro/forma de pagamento f√°cil no momento"
      ],
      optsB: [
        "Compra salgado e refrigerante na padaria antes de chegar ao trabalho",
        "Entra na padaria e escolhe um item para comer na hora",
        "Adia o lanche levado e decide comer algo comprado",
        "Compra algo pronto para consumir rapidamente no caminho"
      ],
      optsC: [
        "Sente prazer imediato e praticidade (evita esfor√ßo de usar o lanche levado)",
        "Reduz a fome rapidamente e mant√©m o ritmo do trajeto",
        "Sente recompensa por 'se presentear' ap√≥s um in√≠cio de dia dif√≠cil",
        "Evita a sensa√ß√£o de priva√ß√£o e a ideia de 'lanche sem gra√ßa'"
      ],
      explain: "O ambiente funciona como est√≠mulo discriminativo; a consequ√™ncia tende a combinar prazer (refor√ßo positivo) e economia de esfor√ßo/tempo (refor√ßo negativo)."
    },
    {
      tag: "Jantar infantil",
      meta: "Crian√ßa ‚Ä¢ fam√≠lia",
      text: "Na hora do jantar, a crian√ßa recusa a comida e chora. Para evitar briga, a m√£e oferece um iogurte doce e libera o celular.",
      hint: "Observe efeitos imediatos para a crian√ßa e para o cuidador.",
      A: "In√≠cio do jantar com exig√™ncia para comer um alimento pouco preferido",
      B: "Recusa a comida e chora na mesa",
      C: "Acessa iogurte doce e celular; conflito/press√£o diminuem imediatamente",
      optsA: [
        "In√≠cio do jantar com exig√™ncia para comer um alimento pouco preferido",
        "Crian√ßa percebe que o cuidador est√° insistindo/pressionando",
        "Crian√ßa est√° cansada e com baixa toler√¢ncia √† frustra√ß√£o no fim do dia",
        "Crian√ßa est√° com fome, mas quer controlar o que vai comer"
      ],
      optsB: [
        "Recusa a comida e chora na mesa",
        "Afasta o prato e faz careta para o alimento",
        "Diz 'n√£o quero' repetidas vezes e aumenta o tom de voz",
        "Se levanta da mesa e tenta sair do jantar"
      ],
      optsC: [
        "Acessa iogurte doce e celular; conflito/press√£o diminuem imediatamente",
        "Ganha alternativa mais palat√°vel e evita o alimento do jantar",
        "Recebe aten√ß√£o imediata e negocia√ß√£o por parte do cuidador",
        "A m√£e sente al√≠vio do conflito e encerra a insist√™ncia naquele momento"
      ],
      explain: "A recusa pode ser mantida por acesso a itens preferidos (refor√ßo positivo) e/ou por fuga da press√£o (refor√ßo negativo). Tamb√©m pode refor√ßar o comportamento do cuidador (al√≠vio ao evitar briga)."
    },
    {
      tag: "Restri√ß√£o ‚Üí excesso",
      meta: "Adulto ‚Ä¢ dieta restritiva",
      text: "O paciente passa o dia comendo muito pouco para 'compensar'. √Ä noite, sente muita fome e come grandes quantidades de p√£o e doces.",
      hint: "Antecedente pode incluir priva√ß√£o fisiol√≥gica e regras r√≠gidas.",
      A: "Passar o dia em restri√ß√£o alimentar (priva√ß√£o) para 'compensar'",
      B: "√Ä noite, come grandes quantidades de p√£o e doces",
      C: "Reduz fome intensa e sensa√ß√£o de priva√ß√£o, com prazer imediato",
      optsA: [
        "Passar o dia em restri√ß√£o alimentar (priva√ß√£o) para 'compensar'",
        "Longo intervalo entre refei√ß√µes e pouca disponibilidade de op√ß√µes pr√°ticas",
        "Terminar o dia com cansa√ßo e pouca energia para preparar refei√ß√£o planejada",
        "Pensar que 'j√° estragou a dieta' depois de um pequeno deslize"
      ],
      optsB: [
        "√Ä noite, come grandes quantidades de p√£o e doces",
        "Come r√°pido e repete por√ß√µes quando chega em casa",
        "Abre v√°rios alimentos dispon√≠veis e alterna entre eles",
        "Come at√© sentir desconforto f√≠sico, apesar de querer parar"
      ],
      optsC: [
        "Reduz fome intensa e sensa√ß√£o de priva√ß√£o, com prazer imediato",
        "Sente al√≠vio por 'finalmente comer' depois de um dia dif√≠cil",
        "Diminui temporariamente ansiedade/irrita√ß√£o do fim do dia",
        "Evita a tarefa de cozinhar e resolve a fome rapidamente"
      ],
      explain: "O ciclo pode se manter porque o epis√≥dio noturno produz al√≠vio imediato da priva√ß√£o e recompensa sensorial, refor√ßando o padr√£o."
    },
    {
      tag: "Ansiedade social",
      meta: "Adulto ‚Ä¢ eventos",
      text: "Em eventos sociais, o paciente fica ansioso e passa a beliscar o tempo todo. Ele diz que assim 'n√£o precisa falar com ningu√©m'.",
      hint: "Procure fun√ß√£o de fuga/evita√ß√£o e/ou regula√ß√£o emocional.",
      A: "Estar em evento social e sentir aumento de ansiedade/desconforto",
      B: "Belisca continuamente durante o evento",
      C: "Evita intera√ß√µes e reduz ansiedade no curto prazo (fuga/evita√ß√£o)",
      optsA: [
        "Estar em evento social e sentir aumento de ansiedade/desconforto",
        "N√£o saber com quem conversar e ficar sem um 'papel' definido no ambiente",
        "Perceber olhares/autoavalia√ß√£o e medo de julgamento",
        "Estar perto da mesa de comida e ter f√°cil acesso aos petiscos"
      ],
      optsB: [
        "Belisca continuamente durante o evento",
        "Come pequenas por√ß√µes repetidas vezes ao longo da conversa",
        "Fica comendo para ocupar as m√£os e o tempo",
        "Pega algo para comer sempre que fica em sil√™ncio"
      ],
      optsC: [
        "Evita intera√ß√µes e reduz ansiedade no curto prazo (fuga/evita√ß√£o)",
        "Sente al√≠vio por ter uma 'atividade' e n√£o precisar falar",
        "Diminui a autopercep√ß√£o desconfort√°vel ao se distrair com a comida",
        "Recebe coment√°rios/aten√ß√£o por estar comendo (o que pode manter)"
      ],
      explain: "O beliscar pode funcionar como estrat√©gia de evita√ß√£o social e regula√ß√£o emocional, sendo refor√ßado negativamente (reduz ansiedade) e √†s vezes positivamente (aten√ß√£o)."
    },
    {
      tag: "Delivery no cansa√ßo",
      meta: "Adulto ‚Ä¢ ades√£o",
      text: "Depois de um dia longo, a paciente chega sem energia e pede delivery. Ela diz que 'n√£o d√°' para cozinhar, mesmo tendo comida em casa.",
      hint: "Cansa√ßo e demanda de esfor√ßo costumam aumentar comportamento de escolha por praticidade.",
      A: "Chegar em casa cansada e com pouca energia/tempo percebido",
      B: "Pede delivery em vez de preparar comida dispon√≠vel",
      C: "Economiza esfor√ßo e obt√©m al√≠vio imediato (praticidade/recompensa)",
      optsA: [
        "Chegar em casa cansada e com pouca energia/tempo percebido",
        "Perceber a cozinha desorganizada e antecipar a tarefa como 'grande'",
        "Estar com fome e querer uma solu√ß√£o r√°pida",
        "Abrir o aplicativo de delivery e ver promo√ß√µes/combos no hor√°rio"
      ],
      optsB: [
        "Pede delivery em vez de preparar comida dispon√≠vel",
        "Abre o aplicativo e finaliza o pedido rapidamente",
        "Escolhe comida pronta para 'resolver' o jantar sem preparo",
        "Decide por refei√ß√£o pronta ap√≥s olhar a geladeira"
      ],
      optsC: [
        "Economiza esfor√ßo e obt√©m al√≠vio imediato (praticidade/recompensa)",
        "Reduz a sensa√ß√£o de sobrecarga ao evitar cozinhar e lavar lou√ßa",
        "Sente prazer imediato por comer algo palat√°vel",
        "Evita lidar com decis√µes alimentares (reduz demanda mental)"
      ],
      explain: "O comportamento pode se manter por refor√ßo negativo (evitar esfor√ßo/sobrecarga) e refor√ßo positivo (prazer/sabor)."
    },
    {
      tag: "Proibi√ß√£o r√≠gida",
      meta: "Adulto ‚Ä¢ regras alimentares",
      text: "O paciente cria a regra 'nunca posso comer chocolate'. Ap√≥s um dia dif√≠cil, ele come chocolate escondido e depois se culpa.",
      hint: "Regras r√≠gidas podem aumentar priva√ß√£o e tornar o item mais 'atrativo'.",
      A: "Dia dif√≠cil + regra r√≠gida de proibi√ß√£o e sensa√ß√£o de priva√ß√£o",
      B: "Come chocolate escondido",
      C: "Prazer/al√≠vio imediato; a culpa vem depois (tardia)",
      optsA: [
        "Dia dif√≠cil + regra r√≠gida de proibi√ß√£o e sensa√ß√£o de priva√ß√£o",
        "Estar sozinho em casa e ter chocolate dispon√≠vel no arm√°rio",
        "Sentir ansiedade e buscar algo para aliviar no momento",
        "Pensar 'j√° falhei hoje mesmo' ap√≥s pequena quebra do plano"
      ],
      optsB: [
        "Come chocolate escondido",
        "Come um peda√ßo e volta para buscar mais",
        "Come r√°pido e tenta 'compensar' depois mentalmente",
        "Vai at√© a cozinha especificamente para pegar chocolate"
      ],
      optsC: [
        "Prazer/al√≠vio imediato; a culpa vem depois (tardia)",
        "Reduz desconforto emocional momentaneamente",
        "Sente sensa√ß√£o de recompensa por 'merecer' ap√≥s o dia dif√≠cil",
        "Evita lidar com emo√ß√µes ao focar no sabor e na textura"
      ],
      explain: "Consequ√™ncias imediatas (prazer/al√≠vio) t√™m maior peso para manter o comportamento do que consequ√™ncias tardias (culpa)."
    },
    {
      tag: "Press√£o ‚Üí recusa",
      meta: "Crian√ßa ‚Ä¢ refei√ß√£o",
      text: "O pai insiste para a crian√ßa 'limpar o prato'. A crian√ßa empurra o prato, faz careta e o pai tira a comida dizendo 't√° bom, deixa'.",
      hint: "Quem √© refor√ßado aqui tamb√©m? (crian√ßa e cuidador).",
      A: "Pai pressiona e insiste para a crian√ßa comer/limpar o prato",
      B: "Crian√ßa faz careta e empurra o prato (recusa ativa)",
      C: "A press√£o cessa imediatamente (fuga/evita√ß√£o do desconforto)",
      optsA: [
        "Pai pressiona e insiste para a crian√ßa comer/limpar o prato",
        "Alimento √© pouco preferido e a crian√ßa antecipa desconforto",
        "A refei√ß√£o est√° demorando e a crian√ßa quer sair da mesa",
        "O pai usa tom de voz mais r√≠gido e aumenta exig√™ncia"
      ],
      optsB: [
        "Crian√ßa faz careta e empurra o prato (recusa ativa)",
        "Crian√ßa vira o rosto e cruza os bra√ßos",
        "Crian√ßa diz 'n√£o vou comer' e come√ßa a reclamar",
        "Crian√ßa tenta levantar e sair da mesa"
      ],
      optsC: [
        "A press√£o cessa imediatamente (fuga/evita√ß√£o do desconforto)",
        "O pai interrompe a insist√™ncia e encerra o conflito",
        "A crian√ßa evita o alimento e ganha pausa/sa√≠da da mesa",
        "A tens√£o do momento diminui e a refei√ß√£o √© encerrada"
      ],
      explain: "A recusa pode ser mantida por refor√ßo negativo (escapar da press√£o). O cuidador tamb√©m pode ser refor√ßado ao parar o conflito (al√≠vio)."
    },
    {
      tag: "TV + beliscos",
      meta: "Adulto ‚Ä¢ rotina noturna",
      text: "√Ä noite, vendo s√©ries, o paciente sempre pega pipoca e refrigerante. Ele relata que 's√≥ de ligar a TV j√° d√° vontade'.",
      hint: "Pense em rotina/est√≠mulo discriminativo + consequ√™ncia imediata (prazer/relaxamento).",
      A: "Ligar a TV e iniciar a s√©rie (rotina associada a comer)",
      B: "Pega pipoca e refrigerante durante a s√©rie",
      C: "Prazer sensorial + associa√ß√£o autom√°tica com entretenimento",
      optsA: [
        "Ligar a TV e iniciar a s√©rie (rotina associada a comer)",
        "Estar sentado no sof√° √† noite, no 'hor√°rio de relaxar'",
        "Sentir vontade de relaxar ap√≥s o dia e buscar conforto",
        "Estar com petiscos e refrigerante facilmente acess√≠veis em casa"
      ],
      optsB: [
        "Pega pipoca e refrigerante durante a s√©rie",
        "Belisca alimentos repetidamente ao longo do epis√≥dio",
        "Levanta algumas vezes para buscar algo para comer durante a s√©rie",
        "Come pequenas por√ß√µes enquanto assiste para 'acompanhar' o entretenimento"
      ],
      optsC: [
        "Prazer sensorial + associa√ß√£o autom√°tica com entretenimento",
        "Sensa√ß√£o imediata de relaxamento e conforto no momento",
        "Redu√ß√£o moment√¢nea do t√©dio ao ocupar-se com a comida",
        "Sensa√ß√£o de recompensa por 'finalizar o dia' com algo gostoso"
      ],
      explain: "A TV pode funcionar como est√≠mulo discriminativo (rotina). A consequ√™ncia imediata costuma envolver prazer e/ou relaxamento, mantendo o h√°bito."
    }
  ];

  const TOTAL_ROUNDS = 10;
  const TIME_LIMIT_SEC = 75;

  // --- State ---
  let order = [];
  let idx = 0;
  let score = 0;
  let hits = 0;
  let selected = {A:null, B:null, C:null};
  let locked = false;
  let timer = null;
  let remaining = TIME_LIMIT_SEC;

  // --- Elements ---
  const elRound = document.getElementById("round");
  const elTotal = document.getElementById("total");
  const elScore = document.getElementById("score");
  const elHits  = document.getElementById("hits");
  const elTag   = document.getElementById("tag");
  const elMeta  = document.getElementById("meta");
  const elCase  = document.getElementById("caseText");
  const elHint  = document.getElementById("caseHint");
  const elChoicesA = document.getElementById("choicesA");
  const elChoicesB = document.getElementById("choicesB");
  const elChoicesC = document.getElementById("choicesC");
  const elSelA = document.getElementById("selA");
  const elSelB = document.getElementById("selB");
  const elSelC = document.getElementById("selC");

  const elSubmit = document.getElementById("submitBtn");
  const elSubmitM = document.getElementById("submitBtnMobile");
  const elNext = document.getElementById("nextBtn");
  const elReset = document.getElementById("resetBtn");
  const elSkip = document.getElementById("skipBtn");
  const elTimer = document.getElementById("timer");

  const fb = document.getElementById("feedback");
  const fbTitle = document.getElementById("fbTitle");
  const fbText = document.getElementById("fbText");
  const fbExtra = document.getElementById("fbExtra");

  const modal = document.getElementById("modal");
  const helpBtn = document.getElementById("helpBtn");
  const closeBtn = document.getElementById("closeBtn");

  // Tabs/steps
  const tabA = document.getElementById("tabA");
  const tabB = document.getElementById("tabB");
  const tabC = document.getElementById("tabC");
  const blockA = document.getElementById("blockA");
  const blockB = document.getElementById("blockB");
  const blockC = document.getElementById("blockC");
  const prevStepBtn = document.getElementById("prevStepBtn");
  const nextStepBtn = document.getElementById("nextStepBtn");

  elTotal.textContent = TOTAL_ROUNDS;

  // --- Helpers ---
  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  };

  function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }
  function startTimer(){
    stopTimer();
    remaining = TIME_LIMIT_SEC;
    elTimer.textContent = `‚è±Ô∏è Tempo: ${remaining}s`;
    timer = setInterval(() => {
      if(locked) return;
      remaining--;
      elTimer.textContent = `‚è±Ô∏è Tempo: ${remaining}s`;
      if(remaining <= 0){
        stopTimer();
        if(!locked){
          locked = true;
          showFeedback("‚è≥ Tempo!", "Tempo esgotado. Voc√™ pode seguir para o pr√≥ximo caso (sem pontuar este).", "Dica: comece pela consequ√™ncia prov√°vel (C), depois volte para A e B.");
          markAllNeutral();
          disableActionsForLocked();
          elNext.style.display = "inline-block";
        }
      }
    }, 1000);
  }

  function resetSelections(){
    selected = {A:null,B:null,C:null};
    elSelA.textContent = "‚Äî";
    elSelB.textContent = "‚Äî";
    elSelC.textContent = "‚Äî";
    setSubmitEnabled(false);
    fb.classList.remove("show");
  }

  function canSubmit(){ return selected.A && selected.B && selected.C; }
  function setSubmitEnabled(v){
    elSubmit.disabled = !v;
    elSubmitM.disabled = !v;
  }

  function setPill(which){
    const map = {A:elSelA, B:elSelB, C:elSelC};
    map[which].textContent = "selecionado";
  }

  function renderChoices(container, options, key){
    container.innerHTML = "";
    options.forEach(txt => {
      const btn = document.createElement("button");
      btn.className = "choice";
      btn.type = "button";
      btn.textContent = txt;
      btn.dataset.key = key;
      btn.dataset.value = txt;
      btn.setAttribute("aria-pressed","false");
      btn.addEventListener("click", () => {
        if(locked) return;
        [...container.querySelectorAll(".choice")].forEach(b => b.setAttribute("aria-pressed","false"));
        btn.setAttribute("aria-pressed","true");
        selected[key] = txt;
        setPill(key);
        setSubmitEnabled(canSubmit());

        // Mobile UX: auto-advance after selecting A or B
        if (isMobileLayout()){
          if(key === "A") setStep(1);
          if(key === "B") setStep(2);
        }
      });
      container.appendChild(btn);
    });
  }

  function showFeedback(title, text, extra=""){
    fbTitle.textContent = title;
    fbText.textContent = text;
    fbExtra.textContent = extra;
    fb.classList.add("show");
    if (isMobileLayout()){
      fb.scrollIntoView({behavior:"smooth", block:"start"});
    }
  }

  function markButtons(container, correctText, selectedText){
    [...container.querySelectorAll(".choice")].forEach(b => {
      const v = b.dataset.value;
      b.classList.remove("ok","bad");
      if(v === correctText) b.classList.add("ok");
      if(selectedText && v === selectedText && selectedText !== correctText) b.classList.add("bad");
    });
  }
  function markAllNeutral(){
    [elChoicesA, elChoicesB, elChoicesC].forEach(c => {
      [...c.querySelectorAll(".choice")].forEach(b => b.classList.remove("ok","bad"));
    });
  }

  function disableActionsForLocked(){
    setSubmitEnabled(false);
    elSkip.disabled = true;
    prevStepBtn.disabled = true;
    nextStepBtn.disabled = true;
  }
  function enableActionsForUnlocked(){
    elSkip.disabled = false;
    prevStepBtn.disabled = false;
    nextStepBtn.disabled = false;
  }

  function lockUI(){
    locked = true;
    disableActionsForLocked();
    elNext.style.display = "inline-block";
    stopTimer();
  }
  function unlockUI(){
    locked = false;
    enableActionsForUnlocked();
    elNext.style.display = "none";
  }

  // --- Steps (mobile tabs) ---
  let step = 0; // 0=A,1=B,2=C
  function isMobileLayout(){
    return window.matchMedia("(max-width: 979px)").matches;
  }
  function setStep(s){
    step = Math.max(0, Math.min(2, s));
    const tabs = [tabA, tabB, tabC];
    const blocks = [blockA, blockB, blockC];
    tabs.forEach((t,i)=>{
      t.classList.toggle("active", i===step);
      t.setAttribute("aria-selected", i===step ? "true":"false");
    });
    blocks.forEach((b,i)=> b.classList.toggle("active", i===step));

    prevStepBtn.disabled = locked || step === 0;
    nextStepBtn.disabled = locked || step === 2;

    document.getElementById("submitBtnMobile").style.display = (step === 2) ? "inline-block" : "none";
    nextStepBtn.style.display = (step === 2) ? "none" : "inline-block";
  }

  tabA.addEventListener("click", ()=> setStep(0));
  tabB.addEventListener("click", ()=> setStep(1));
  tabC.addEventListener("click", ()=> setStep(2));
  prevStepBtn.addEventListener("click", ()=> setStep(step-1));
  nextStepBtn.addEventListener("click", ()=> setStep(step+1));

  // --- Game loop ---
  function loadRound(){
    unlockUI();
    resetSelections();
    markAllNeutral();

    const q = order[idx];
    elRound.textContent = String(idx+1);
    elTag.textContent = `Caso ${idx+1} ‚Ä¢ ${q.tag}`;
    elMeta.textContent = q.meta;
    elCase.textContent = q.text;
    elHint.textContent = `Dica: ${q.hint}`;

    renderChoices(elChoicesA, shuffle(q.optsA), "A");
    renderChoices(elChoicesB, shuffle(q.optsB), "B");
    renderChoices(elChoicesC, shuffle(q.optsC), "C");

    setStep(0);
    startTimer();
  }

  function gradeRound(){
    const q = order[idx];
    const results = {A: selected.A === q.A, B: selected.B === q.B, C: selected.C === q.C};

    const gained = (results.A?10:0) + (results.B?10:0) + (results.C?10:0);
    score += gained;
    hits += (results.A?1:0) + (results.B?1:0) + (results.C?1:0);

    elScore.textContent = String(score);
    elHits.textContent = String(hits);

    markButtons(elChoicesA, q.A, selected.A);
    markButtons(elChoicesB, q.B, selected.B);
    markButtons(elChoicesC, q.C, selected.C);

    const correctCount = (results.A?1:0) + (results.B?1:0) + (results.C?1:0);
    const title = correctCount === 3 ? "‚úÖ Perfeito!" :
                  (correctCount === 2 ? "üü° Quase l√°!" :
                  (correctCount === 1 ? "üü† Vamos ajustar!" : "üî¥ Vamos revisar!"));

    showFeedback(title, `Voc√™ acertou ${correctCount}/3 itens e ganhou ${gained} pontos.`, `Explica√ß√£o: ${q.explain}`);
    lockUI();
    setStep(2);
  }

  function finishGame(){
    stopTimer();
    const maxScore = TOTAL_ROUNDS * 30;
    const pct = Math.round((score / maxScore) * 100);
    showFeedback("üèÅ Fim do jogo!",
      `Pontua√ß√£o final: ${score}/${maxScore} (${pct}%). Acertos (itens A/B/C): ${hits}/${TOTAL_ROUNDS*3}.`,
      "Sugest√£o: refa√ßa come√ßando pela consequ√™ncia (C) e descrevendo A/B com termos observ√°veis.");
    elNext.style.display = "none";
    elSkip.disabled = true;
    setSubmitEnabled(false);
  }

  function startGame(){
    const picked = shuffle(BANK);
    order = [];
    for(let i=0;i<TOTAL_ROUNDS;i++) order.push(picked[i % picked.length]);
    idx = 0;
    score = 0;
    hits = 0;
    elScore.textContent = "0";
    elHits.textContent = "0";
    elSkip.disabled = false;
    loadRound();
  }

  // Buttons
  elSubmit.addEventListener("click", ()=> { if(!locked && canSubmit()) gradeRound(); });
  elSubmitM.addEventListener("click", ()=> { if(!locked && canSubmit()) gradeRound(); });

  elReset.addEventListener("click", ()=> startGame());

  elNext.addEventListener("click", ()=> {
    if(idx < TOTAL_ROUNDS-1){ idx++; loadRound(); }
    else finishGame();
  });

  elSkip.addEventListener("click", ()=> {
    if(locked) return;
    locked = true;
    stopTimer();
    showFeedback("‚è≠Ô∏è Caso pulado", "Voc√™ pulou este caso (0 pontos). V√° para o pr√≥ximo.", "Dica: na pr√≥xima, tente identificar primeiro a consequ√™ncia imediata (C).");
    disableActionsForLocked();
    elNext.style.display = "inline-block";
  });

  // Modal
  helpBtn.addEventListener("click", ()=> modal.classList.add("show"));
  closeBtn.addEventListener("click", ()=> modal.classList.remove("show"));
  modal.addEventListener("click", (e)=> { if(e.target === modal) modal.classList.remove("show"); });

  // Keyboard shortcuts
  document.addEventListener("keydown", (e) => {
    if(modal.classList.contains("show")){
      if(e.key === "Escape") modal.classList.remove("show");
      return;
    }
    if(e.key === "1") setStep(0);
    if(e.key === "2") setStep(1);
    if(e.key === "3") setStep(2);
    if(e.key === "Enter" && !elSubmit.disabled) elSubmit.click();
    if(e.key === "Escape" && elNext.style.display !== "none") elNext.click();
  });

  window.addEventListener("resize", ()=> setStep(step));

  // Start
  startGame();
})();
</script>
</body>
</html>
